<% if filtered_by_category %>
  <% category_selected.references.each do |reference| %>
    <% if filtered_by_owned && owned_selected == 1 %>
      <% if owned_references.include? reference %>
        <div class="item-ref" data-reference=<%= reference.id %>>
          <%= render 'item', reference: reference %>
        </div>
      <% end %>
    <% elsif  filtered_by_owned && owned_selected == -1 %>
      <% unless owned_references.include? reference %>
        <div class="item-ref" data-reference=<%= reference.id %>>
          <%= render 'item', reference: reference %>
        </div>
      <% end %>
    <% else %>
        <div class="item-ref" data-reference=<%= reference.id %>>
          <%= render 'item', reference: reference %>
        </div>
    <% end %>
  <% end %>

<% else %>
  <% categories.each do |category| %>
    <% category.references.each do |reference| %>
      <% if filtered_by_owned && owned_selected == 1 %>
        <% if owned_references.include? reference %>
          <div class="item-ref" data-reference=<%= reference.id %>>
            <%= render 'item', reference: reference %>
          </div>
        <% end %>
      <% elsif  filtered_by_owned && owned_selected == -1 %>
        <% unless owned_references.include? reference %>
          <div class="item-ref" data-reference=<%= reference.id %>>
            <%= render 'item', reference: reference %>
          </div>
        <% end %>
      <% else %>
          <div class="item-ref" data-reference=<%= reference.id %>>
            <%= render 'item', reference: reference %>
          </div>
      <% end %>
    <% end %>
  <% end %>

<% end %>
